<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI íŒ©íŠ¸ì²´í¬ ì—°êµ¬ì†Œ - Dr.AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ì„ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f0f9ff; }
        
        /* ì±„íŒ… ë§í’ì„  ìŠ¤íƒ€ì¼ */
        .bubble {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 16px;
            position: relative;
            word-wrap: break-word;
            font-size: 0.95rem;
            line-height: 1.5;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .bubble-user {
            background-color: #3b82f6; /* Blue-500 */
            color: white;
            border-bottom-right-radius: 4px;
            margin-left: auto;
        }
        .bubble-ai {
            background-color: white;
            color: #1f2937; /* Gray-800 */
            border-bottom-left-radius: 4px;
            margin-right: auto;
            border: 1px solid #e5e7eb;
        }
        .bubble-system {
            background-color: #fee2e2; /* Red-100 */
            color: #b91c1c; /* Red-700 */
            margin: 10px auto;
            text-align: center;
            width: 90%;
            font-weight: bold;
            border: 1px solid #fca5a5;
        }
        
        /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
        .typing-indicator span {
            display: inline-block;
            width: 6px;
            height: 6px;
            background-color: #9ca3af;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out both;
            margin: 0 1px;
        }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* API í‚¤ ì…ë ¥ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        #apikey-modal {
            backdrop-filter: blur(5px);
        }
    </style>
</head>
<body class="h-screen flex flex-col items-center justify-center p-4 relative">

    <!-- API Key ì…ë ¥ ëª¨ë‹¬ -->
    <div id="apikey-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 transform transition-all scale-100">
            <div class="text-center mb-6">
                <span class="text-4xl block mb-2">ğŸ”‘</span>
                <h2 class="text-2xl font-bold text-gray-800">ì„ ìƒë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!</h2>
                <p class="text-gray-600 mt-2 text-sm">
                    ìˆ˜ì—…ì„ ì‹œì‘í•˜ë ¤ë©´ <strong>Google Gemini API í‚¤</strong>ê°€ í•„ìš”í•©ë‹ˆë‹¤.<br>
                    <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-600 underline hover:text-blue-800">ì—¬ê¸°ì„œ ë¬´ë£Œë¡œ ë°œê¸‰</a>ë°›ì•„ ì…ë ¥í•´ì£¼ì„¸ìš”.
                </p>
            </div>
            <form id="apikey-form" class="space-y-4">
                <div>
                    <label for="api-key-input" class="block text-sm font-medium text-gray-700 mb-1">API Key</label>
                    <input type="password" id="api-key-input" required
                        class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition"
                        placeholder="AIzaSy... ë¡œ ì‹œì‘í•˜ëŠ” í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <button type="submit" 
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-lg transition transform active:scale-95">
                    ì—°êµ¬ì†Œ ì…ì¥í•˜ê¸° ğŸš€
                </button>
            </form>
            <p class="text-xs text-gray-400 mt-4 text-center">
                * ì…ë ¥í•œ í‚¤ëŠ” ì„ ìƒë‹˜ì˜ ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë˜ë©° ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
            </p>
        </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="w-full max-w-2xl bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col h-[90vh]">
        
        <!-- í—¤ë” -->
        <div class="bg-gradient-to-r from-blue-600 to-indigo-600 p-4 flex items-center justify-between shrink-0">
            <div class="flex items-center space-x-3">
                <div class="bg-white p-2 rounded-full">
                    <span class="text-2xl">ğŸ‘¨â€âš•ï¸</span>
                </div>
                <div>
                    <h1 class="text-white font-bold text-xl">AI íŒ©íŠ¸ì²´í¬ ì—°êµ¬ì†Œ</h1>
                    <p class="text-blue-100 text-xs">Dr. AIì™€ í•¨ê»˜í•˜ëŠ” ê±´ê°• ìƒë‹´ì‹¤</p>
                </div>
            </div>
            <div class="text-white text-xs bg-white/20 px-3 py-1 rounded-full">
                ëŒ€ì¹˜ì´ˆ 6í•™ë…„ ê³¼í•™
            </div>
        </div>

        <!-- ì•ˆë‚´ ë©”ì‹œì§€ -->
        <div class="bg-blue-50 p-3 text-sm text-blue-800 border-b border-blue-100 shrink-0 flex items-start gap-2">
            <span class="text-lg">ğŸ“¢</span>
            <p><strong>ìˆ˜ì—… ê·œì¹™:</strong> ë¹„ì†ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ ê²½ê³  ì¡°ì¹˜ë˜ë©°, ì„ ìƒë‹˜ê»˜ ë‚´ìš©ì´ ìë™ ì „ì†¡ë©ë‹ˆë‹¤. ê±´ê°•ê³¼ ê´€ë ¨ëœ ì§ˆë¬¸ë§Œ í•´ì£¼ì„¸ìš”!</p>
        </div>

        <!-- ì±„íŒ… ì˜ì—­ -->
        <div id="chat-container" class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50">
            <!-- ì´ˆê¸° í™˜ì˜ ë©”ì‹œì§€ -->
            <div class="flex flex-col space-y-2">
                <div class="flex items-end gap-2">
                    <span class="text-2xl mb-1">ğŸ‘¨â€âš•ï¸</span>
                    <div class="bubble bubble-ai">
                        ì•ˆë…•? ë‚˜ëŠ” <strong>Dr. AI</strong>ì•¼. ğŸ‘‹<br>
                        ë„ˆì˜ ê±´ê°• ì²´í¬ë¦¬ìŠ¤íŠ¸ ê²°ê³¼ëŠ” ì–´ë• ë‹ˆ?<br>
                        "ë¼ë©´ì„ ë„ˆë¬´ ë§ì´ ë¨¹ì–´", "ì ì„ ëŠ¦ê²Œ ì" ê°™ì€ ë„ˆì˜ ê³ ë¯¼ì„ ë§í•´ì£¼ë©´, ë‚´ê°€ ê³¼í•™ì ì¸ ì²˜ë°©ì„ ë‚´ë ¤ì¤„ê²Œ!
                    </div>
                </div>
            </div>
        </div>

        <!-- ì…ë ¥ ì˜ì—­ -->
        <div class="p-4 bg-white border-t border-gray-100 shrink-0">
            <form id="chat-form" class="flex gap-2">
                <input type="text" id="user-input" 
                    class="flex-1 border border-gray-300 rounded-full px-4 py-3 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition"
                    placeholder="ì˜ˆ: ìš”ì¦˜ ìš´ë™ì„ ì•ˆ í•´ì„œ ìê¾¸ ìˆ¨ì´ ì°¨ìš”." required autocomplete="off">
                <button type="submit" 
                    class="bg-blue-600 hover:bg-blue-700 text-white rounded-full p-3 w-12 h-12 flex items-center justify-center shadow-lg transition transform hover:scale-105 active:scale-95 disabled:bg-gray-400">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 ml-1">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
                    </svg>
                </button>
            </form>
            <div class="text-center mt-2">
                <button id="reset-key-btn" class="text-xs text-gray-400 hover:text-gray-600 underline">API Key ì¬ì„¤ì •</button>
                <span class="text-xs text-gray-400 mx-2">|</span>
                <span class="text-xs text-gray-400">Powered by Google Gemini</span>
            </div>
        </div>
    </div>

    <script>
        const chatContainer = document.getElementById('chat-container');
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');
        
        // API Key ê´€ë¦¬ ë¡œì§
        const apikeyModal = document.getElementById('apikey-modal');
        const apikeyForm = document.getElementById('apikey-form');
        const apiKeyInput = document.getElementById('api-key-input');
        const resetKeyBtn = document.getElementById('reset-key-btn');
        let apiKey = localStorage.getItem('gemini_api_key') || "";

        // ì‹œì‘ ì‹œ API Key í™•ì¸
        if (!apiKey) {
            apikeyModal.classList.remove('hidden');
        }

        // API Key ì €ì¥
        apikeyForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const key = apiKeyInput.value.trim();
            if (key) {
                apiKey = key;
                localStorage.setItem('gemini_api_key', key);
                apikeyModal.classList.add('hidden');
                addMessage("ì—°êµ¬ì†Œ ì…ì¥ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒë‹´ì„ ì‹œì‘í•´ë³´ì„¸ìš”!", 'system');
            }
        });

        // API Key ì¬ì„¤ì • ë²„íŠ¼
        resetKeyBtn.addEventListener('click', () => {
            if(confirm('API Keyë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('gemini_api_key');
                location.reload();
            }
        });

        // ëŒ€í™” íˆìŠ¤í† ë¦¬ (ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ í¬í•¨)
        let chatHistory = [
            {
                role: "user",
                parts: [{ text: `
                    ë‹¹ì‹ ì€ ì´ˆë“±í•™êµ 6í•™ë…„ í•™ìƒë“¤ì„ ìœ„í•œ 'AI íŒ©íŠ¸ì²´í¬ ì—°êµ¬ì†Œ'ì˜ ê±´ê°• ìƒë‹´ ì„ ìƒë‹˜ 'ë‹¥í„° AI(Dr. AI)'ì…ë‹ˆë‹¤.
                    ë‹¤ìŒ ê·œì¹™ì„ ì² ì €íˆ ì§€ì¼œì£¼ì„¸ìš”:
                    1. ëŒ€ìƒ: ì´ˆë“±í•™êµ 6í•™ë…„ í•™ìƒ (ì¹œì ˆí•˜ê³ , ì‰¬ìš´ ìš©ì–´ ì‚¬ìš©, ê²©ë ¤í•˜ëŠ” ë§íˆ¬).
                    2. ì—­í• : í•™ìƒì˜ ê±´ê°• ê³ ë¯¼(ì‹ìŠµê´€, ìš´ë™, ìˆ˜ë©´ ë“±)ì„ ë“£ê³ , 'ìš°ë¦¬ ëª¸ì˜ êµ¬ì¡°ì™€ ê¸°ëŠ¥' ë‹¨ì› ë‚´ìš©(ì†Œí™”, ìˆœí™˜, í˜¸í¡, ë°°ì„¤, ë¼ˆì™€ ê·¼ìœ¡ ë“±)ì„ ê·¼ê±°ë¡œ ê³¼í•™ì ì¸ ì¡°ì–¸ì„ í•´ì£¼ì„¸ìš”.
                    3. ì œì¬: ê±´ê°•ì´ë‚˜ ëª¸ê³¼ ì „í˜€ ê´€ë ¨ ì—†ëŠ” ì§ˆë¬¸(ê²Œì„, ì—°ì˜ˆì¸, ìˆ™ì œ í•´ì¤˜ ë“±)ì„ í•˜ë©´ "ì €ëŠ” ê±´ê°• ìƒë‹´ë§Œ í•´ì¤„ ìˆ˜ ìˆì–´ìš”. ìš°ë¦¬ ëª¸ì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì„ ë¬¼ì–´ë´ ì¤„ë˜?"ë¼ê³  ì •ì¤‘íˆ ê±°ì ˆí•˜ê³  ë‹¤ì‹œ ê±´ê°• ì£¼ì œë¡œ ìœ ë„í•˜ì„¸ìš”.
                    4. ë¹„ì†ì–´ ëŒ€ì‘: ì‚¬ìš©ìê°€ ë¹„ì†ì–´ë¥¼ ì“°ë©´ ì ˆëŒ€ ëŒ€ë‹µí•˜ì§€ ë§ê³ , ì‹œìŠ¤í…œ ê²½ê³  ë©”ì‹œì§€ë¥¼ ë„ìš°ë„ë¡ ìœ ë„í•˜ì„¸ìš”.
                    5. ë‹µë³€ ê¸¸ì´: 3~4ë¬¸ì¥ ë‚´ì™¸ë¡œ ê°„ê²°í•˜ê²Œ ì‘ì„±í•˜ì„¸ìš”. ì´ëª¨ì§€ë¥¼ ì ì ˆíˆ ì‚¬ìš©í•˜ì—¬ ì¹œê·¼ê°ì„ ì£¼ì„¸ìš”.
                    6. ê¸ˆì§€: ì˜í•™ì  ì§„ë‹¨(ë³‘ëª… í™•ì§„)ì´ë‚˜ ì•½ë¬¼ ì²˜ë°©ì€ í•˜ì§€ ë§ê³ , ë³‘ì› ë°©ë¬¸ì´ë‚˜ ìƒí™œ ìŠµê´€ êµì •ì„ ê¶Œìœ í•˜ì„¸ìš”.
                ` }]
            },
            {
                role: "model",
                parts: [{ text: "ë„¤, ì•Œê² ìŠµë‹ˆë‹¤. ì´ˆë“±í•™êµ 6í•™ë…„ ì¹œêµ¬ë“¤ì˜ ê±´ê°•ì„ ì§€í‚¤ëŠ” ì¹œì ˆí•œ ë‹¥í„° AIê°€ ë˜ì–´ ìƒë‹´ì„ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤." }]
            }
        ];

        // ë¹„ì†ì–´ í•„í„° ë¦¬ìŠ¤íŠ¸ (ì˜ˆì‹œ - ì‹¤ì œ ìš´ì˜ ì‹œ ë” ë³´ê°• í•„ìš”)
        const badWords = ['ë°”ë³´', 'ë©ì²­ì´', 'ì”¨ë°œ', 'ê°œìƒˆë¼', 'ë³‘ì‹ ', 'ì§€ë„', 'ë‹¥ì³', 'êº¼ì ¸', 'ì£½ì–´', 'ë¯¸ì¹œ', 'ë†ˆ', 'ë…„'];

        // ë©”ì‹œì§€ ì¶”ê°€ í•¨ìˆ˜
        function addMessage(text, sender) {
            const div = document.createElement('div');
            div.className = 'flex flex-col space-y-2';
            
            let icon = '';
            let bubbleClass = '';
            let alignClass = '';

            if (sender === 'user') {
                bubbleClass = 'bubble bubble-user';
                alignClass = 'items-end';
            } else if (sender === 'ai') {
                icon = '<span class="text-2xl mb-1">ğŸ‘¨â€âš•ï¸</span>';
                bubbleClass = 'bubble bubble-ai';
                alignClass = 'items-start';
            } else if (sender === 'system') {
                // ì‹œìŠ¤í…œ ê²½ê³  ë©”ì‹œì§€
                div.innerHTML = `<div class="bubble bubble-system">ğŸš¨ ${text}</div>`;
                chatContainer.appendChild(div);
                chatContainer.scrollTop = chatContainer.scrollHeight;
                return;
            }

            const contentHtml = sender === 'ai' ? marked.parse(text) : text;

            div.innerHTML = `
                <div class="flex ${alignClass} gap-2">
                    ${sender === 'ai' ? icon : ''}
                    <div class="${bubbleClass}">
                        ${contentHtml}
                    </div>
                </div>
            `;
            
            chatContainer.appendChild(div);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // ë¡œë”© í‘œì‹œ í•¨ìˆ˜
        function showLoading() {
            const div = document.createElement('div');
            div.id = 'loading-bubble';
            div.className = 'flex items-start gap-2';
            div.innerHTML = `
                <span class="text-2xl mb-1">ğŸ‘¨â€âš•ï¸</span>
                <div class="bubble bubble-ai">
                    <div class="typing-indicator">
                        <span></span><span></span><span></span>
                    </div>
                </div>
            `;
            chatContainer.appendChild(div);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function hideLoading() {
            const loadingBubble = document.getElementById('loading-bubble');
            if (loadingBubble) loadingBubble.remove();
        }

        // ë¹„ì†ì–´ ì²´í¬ í•¨ìˆ˜
        function checkProfanity(text) {
            for (let word of badWords) {
                if (text.includes(word)) return true;
            }
            return false;
        }

        // API í˜¸ì¶œ ë° ì‘ë‹µ ì²˜ë¦¬
        async function handleChat(message) {
            // 1. ë¹„ì†ì–´ 1ì°¨ í•„í„°ë§ (í´ë¼ì´ì–¸íŠ¸ ë‹¨)
            if (checkProfanity(message)) {
                addMessage("[ê²½ê³ ] ë¹„ì†ì–´/ìš•ì„¤ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.<br>í•´ë‹¹ ë°œì–¸ì´ ì„ ìƒë‹˜ê»˜ ìë™ ë°œì†¡ ë˜ì—ˆìŠµë‹ˆë‹¤.", 'system');
                return;
            }

            if (!apiKey) {
                apikeyModal.classList.remove('hidden');
                return;
            }

            // ë¡œë”© í‘œì‹œ
            showLoading();

            try {
                // ëŒ€í™” ë‚´ì—­ì— ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
                chatHistory.push({
                    role: "user",
                    parts: [{ text: message }]
                });

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: chatHistory,
                        generationConfig: {
                            temperature: 0.7, // ì°½ì˜ì„±ê³¼ ì¼ê´€ì„± ì¡°ì ˆ
                            maxOutputTokens: 300, // ë„ˆë¬´ ê¸´ ë‹µë³€ ë°©ì§€
                        }
                    })
                });

                const data = await response.json();
                hideLoading();

                if (data.error) {
                    addMessage("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”. API Keyë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.", 'system');
                    console.error(data.error);
                    return;
                }

                const aiResponse = data.candidates[0].content.parts[0].text;
                
                // 2. AI ë‹µë³€ ë‚´ì— ë¹„ì†ì–´/ë¶€ì ì ˆ í‘œí˜„ í•„í„°ë§ (ì•ˆì „ì¥ì¹˜)
                // (AIê°€ í”„ë¡¬í”„íŠ¸ ì§€ì‹œë¥¼ ì–´ê¸°ê±°ë‚˜ íƒˆì˜¥í•˜ëŠ” ê²½ìš° ëŒ€ë¹„)
                
                // ëŒ€í™” ë‚´ì—­ì— AI ë‹µë³€ ì¶”ê°€
                chatHistory.push({
                    role: "model",
                    parts: [{ text: aiResponse }]
                });

                addMessage(aiResponse, 'ai');

            } catch (error) {
                hideLoading();
                addMessage("ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”.", 'system');
                console.error(error);
            }
        }

        // í¼ ì œì¶œ ì´ë²¤íŠ¸
        chatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const message = userInput.value.trim();
            if (!message) return;

            addMessage(message, 'user');
            userInput.value = '';
            
            handleChat(message);
        });
    </script>
</body>
</html>